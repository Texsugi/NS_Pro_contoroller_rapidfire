# コントローラー改造基板 ユーザーマニュアル
本書は、本改造基板に書き込まれているファームウェアの仕様をもとに、**ユーザーが実際に操作・設定するための手引き**としてまとめたものです。

## 1. 概要
本基板は、家庭用ゲームコントローラーに組み込んで使用する **多機能入力制御（連射・ダブルクリック・トグル）基板** です。

* 各ボタンごとに動作モードを個別設定可能
* LED（RGB）による視覚的フィードバック
* 設定内容はフラッシュに保存され、電源OFF後も保持
* 無操作状態が続くと自動的に省電力スリープへ移行

## 2. 対応ボタン
本基板は **16ボタン** に対応しています。

 A
 B 
 X 
 Y 
 L 
 R 
 ZL 
 ZR
 ↑ 
 ↓
 ← 
 → 
 HOME
 SS
 ＋ 
 － 


## 3. 動作モード一覧
各ボタンには以下の **4種類のモード** を設定できます。

### MODE_OFF（通常）

* 完全パススルー
* 押したらON、離したらOFF
* 連射・特殊動作なし

### MODE_RAPID（連射）

* ボタンを押している間、連射
* **素早く2回押し（ダブルクリック）** → 常時ON（押しっぱなし状態）
* 離すと停止

用途例：連打が必要なアクション

### MODE_DOUBLE（ダブルクリック連射）

* 単押し：通常入力
* ダブルクリック：連射開始
* 離すと停止

用途例：通常操作と連射を使い分けたい場合

### MODE_TOGGLE（トグル）

* 押すたびに ON / OFF 切り替え
* ON中は連射

用途例：長時間連射を維持したい操作

## 4. LED表示仕様

### 4.1 通常時（虹色LED）

* 虹色アニメーションが有効な場合、通常時にLEDが自動で変化
* 設定モード中は虹色表示は停止

| 状態    | 表示         |
| ----- | ---------- |
| 通常動作  | 虹色アニメーション  |
| 設定モード | 固定色 / 点滅表示 |

### 4.2 モード表示色

| モード                           | LED色 |
| ----------------------------- | ---- |
| MODE_RAPID                    | 赤    |
| MODE_DOUBLE                   | 緑    |
| MODE_TOGGLE                   | 青    |
| 上下限値                          | 紫点滅  |
| 100ms / 200ms / 300ms / 400ms | 白点滅  |

## 5. 設定モード

### 5.1 設定モードへの入り方

1. **L + R + ZL + ZR を同時押し**
2. **5秒間押し続ける**
3. LEDがアニメーション表示 → 設定モード突入

### 5.2 ボタン選択

* 設定モード中に **設定したいボタンを1回押す**
* そのボタンが「選択中」状態になります

### 5.3 設定操作一覧

| 操作ボタン | 内容                                   |
| ----- | ------------------------------------ |
| ZR    | モード切替（OFF → RAPID → DOUBLE → TOGGLE） |
| R     | 連射間隔を短く（－5ms）                        |
| L     | 連射間隔を長く（＋5ms）                        |
| ＋     | 初弾ON時間を速く                            |
| －     | 初弾ON時間を遅く                            |
| HOME  | 2発目以降 ON時間を速く                        |
| SS    | 2発目以降 ON時間を遅く                        |
| ↑     | 虹色LED 有効                             |
| ↓     | 虹色LED 無効                             |

※ 各操作時、LED色で現在の設定が一時表示されます。

### 5.4 初弾パルス（1発目）のON時間

選択肢（ms）：

* 35 / 52 / 69 / 86

| 時間   | LED色 |
| ---- | ---- |
| 35ms | シアン  |
| 52ms | 白    |
| 69ms | 紫    |
| 86ms | 黄    |

### 5.5 2発目以降のON時間

選択肢（ms）：

* 20 / 27 / 34 / 51

| 時間   | LED色 |
| ---- | ---- |
| 20ms | 紫    |
| 27ms | 黄    |
| 34ms | 水色   |
| 51ms | オレンジ |

### 5.6 設定モードの終了

1. **ZLを5秒間長押し**
2. LEDがアニメーション表示
3. 設定内容が保存され通常動作へ復帰

## 6. 設定保存について

* 設定は **本体フラッシュメモリ** に保存されます
* 電源を切っても設定は保持されます
* 初回起動時は全ボタン MODE_OFF で初期化

## 7. 省電力機能（スリープ）

* **60秒間 操作がない場合**、自動で省電力モードへ移行
* LED消灯、出力OFF
* HOME / A / ZL / ZR のボタン入力で復帰

## 8. 注意事項

* 設定モード中はゲーム操作は行われません
* 設定中に電源を切らないでください（保存失敗防止）
* 本基板は非公式改造品です。使用は自己責任で行ってください

## 9. ファームウェア

本改造基板は Raspberry Pi Pico 系マイコンをベースとしており、用途に応じて以下の開発環境・ファームウェア方式で書き込み／更新が可能です。

※ 本製品出荷時は **Pico SDK（C/C++）でビルドされた専用ファームウェア** が書き込まれています。

### 9.1 ファームウェア書き込みの基本手順（共通）

ファームウェアのインストール／アップデートは、**UF2ファイルのドラッグ＆ドロップ**で行います。

**手順：**

1. 基板上の指定ボタン（BOOT用）を押し続ける
2. ボタンを押したまま、PCと基板を **USB-Cケーブル** で接続
3. PC上に「RPI-RP2」というUSBストレージが表示される
4. UF2ファイル（ファームウェア）をドロップ＆ドロップ
5. 自動的に再起動し、書き込み完了

※ インストール後は USBストレージは自動的に切断されます。

### 9.2 MicroPython を使用する場合

MicroPythonは、Python風の文法で簡単に制御ロジックを記述できる開発環境です。

* 初学者向け・試作向け
* ファイル単位で動作確認が容易

**概要：**

* 公式 MicroPython UF2 を書き込み
* main.py / 各種 .py ファイルを内部ストレージに配置
* 再起動で自動実行

**用途例：**

* LED動作の検証
* 簡易的な連射ロジックのテスト

### 9.3 Pico SDK（C/C++）を使用する場合

Pico SDK は Raspberry Pi Pico 公式の C/C++ 開発環境です。

* 高速・低遅延
* 省電力制御（Powman）など高度な制御が可能
* 本製品の標準ファームウェア方式

**概要：**

* PC上でソースコードをビルド
* 生成された UF2 ファイルを基板に書き込み
* 書き込み後はスタンドアロン動作

**用途例：**

* 競技向け低遅延連射
* 複雑な入力判定・省電力制御

### 9.4 Arduino（Arduino-Pico）を使用する場合

Arduino環境を使って Raspberry Pi Pico を扱う方法もあります。

* Arduino IDE から直接書き込み可能
* C++だが比較的簡単

**概要：**

* Arduino IDE に「Raspberry Pi Pico」ボードを追加
* スケッチを書いてビルド
* UF2形式で書き込み、またはIDEから直接転送

**用途例：**

* Arduinoに慣れているユーザー向け
* 簡易カスタムファームの作成

### 9.5 注意事項

* ファームウェア更新中は USB ケーブルを抜かないでください
* 書き込みに失敗した場合は、再度 BOOT 操作からやり直してください
* 非公式ファームウェア使用時の動作保証はありません

---

## 10. まとめ

* ボタン単位で高度な入力制御が可能
* LEDによる直感的な設定
* スリープ対応で省電力

**競技用途・練習用途に特化した高機能コントローラー拡張基板です。**


#GPIO定義

outputs = {
    'A': Pin(36, Pin.OUT), 'B': Pin(34, Pin.OUT), 'X': Pin(32, Pin.OUT), 'Y': Pin(27, Pin.OUT),
    'L': Pin(33, Pin.OUT), 'R': Pin(30, Pin.OUT), 'ZL': Pin(31, Pin.OUT),
    'UP': Pin(16, Pin.OUT), 'DOWN': Pin(18, Pin.OUT), 'LEFT': Pin(19, Pin.OUT), 'RIGHT': Pin(17, Pin.OUT),
    'Home': Pin(11, Pin.OUT), 'SS': Pin(9, Pin.OUT), '+': Pin(13, Pin.OUT), '-': Pin(10, Pin.OUT)
}

switches = {
    'A': Pin(43, Pin.IN, Pin.PULL_UP), 'B': Pin(42, Pin.IN, Pin.PULL_UP),
    'X': Pin(44, Pin.IN, Pin.PULL_UP), 'Y': Pin(41, Pin.IN, Pin.PULL_UP),
    'L': Pin(1, Pin.IN, Pin.PULL_UP), 'R': Pin(2, Pin.IN, Pin.PULL_UP),
    'ZL': Pin(0, Pin.IN, Pin.PULL_UP),
    'UP': Pin(20, Pin.IN, Pin.PULL_UP), 'DOWN': Pin(23, Pin.IN, Pin.PULL_UP),
    'LEFT': Pin(21, Pin.IN, Pin.PULL_UP), 'RIGHT': Pin(22, Pin.IN, Pin.PULL_UP),
    'Home': Pin(4, Pin.IN, Pin.PULL_UP), 'SS': Pin(6, Pin.IN, Pin.PULL_UP),
    '+': Pin(5, Pin.IN, Pin.PULL_UP), '-': Pin(7, Pin.IN, Pin.PULL_UP)
}


#RGBLED(anode common)

RGB_R = Pin(45, Pin.OUT)
RGB_G = Pin(46, Pin.OUT)
RGB_B = Pin(47, Pin.OUT)

#外部接続用GPIO  
Pin1 = 3.3V  
Pin2 = GPIO37  
Pin3 = GPIO38  
Pin4 = GPIO39  
Pin5 = GPIO40  
Pin6 = GND  
